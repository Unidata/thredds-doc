<!DOCTYPE html>
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>TDS Monitoring and Debugging | THREDDS Documentation</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-unidata.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="www.unidata.ucar.edufeed.xml">

  <script>
    $(document).ready(function() {
      // Initialize navgoco with default options
      $("#mysidebar").navgoco({
        caretHtml: '',
        accordion: true,
        openClass: 'active', // open
        save: false, // leave false or nav highlighting doesn't work right
        cookie: {
          name: 'navgoco',
          expires: false,
          path: '/'
        },
        slide: {
          duration: 400,
          easing: 'swing'
        }
      });

      $("#collapseAll").click(function(e) {
        e.preventDefault();
        $("#mysidebar").navgoco('toggle', false);
      });

      $("#expandAll").click(function(e) {
        e.preventDefault();
        $("#mysidebar").navgoco('toggle', true);
      });

    });
  </script>
  <script>
    $(function() {
      $('[data-toggle="tooltip"]').tooltip()
    })
  </script>
  

</head>

<body>
  <!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> THREDDS Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">THREDDS Source<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/Unidata/THREDDS" target="_blank">netCDF-Java and TDS Github Repo</a></li>
                        
                        
                        
                        <li><a href="https://github.com/Unidata/Rosetta" target="_blank">Rosetta Github Repo</a></li>
                        
                        
                        
                        <li><a href="https://github.com/Unidata/siphon" target="_blank">Siphon Github Repo</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorial<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="tds_tutorial_index.html">THREDDS Data Server Tutorial</a></li>
                        
                        
                        
                        <li><a href="netcdf_java_tutorial_index.html">netCDF-Java Tutorial</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Docs<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://www.unidata.ucar.edu/software/rosetta/docs/" target="_blank">Rosetta</a></li>
                        
                        
                        
                        <li><a href="https://siphon.readthedocs.io/en/latest/#" target="_blank">Siphon</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
			<li><a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:support-thredds@unidata.ucar.edu?subject=THREDDS Documentation Feedback f eedback&body=I have some feedback about the TDS Monitoring and Debugging page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a><li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="TDS Monitoring and Debugging">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

  <!-- Page Content -->
  <div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
      <!-- Sidebar Column -->
      <div class="col-md-3">

        







<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">TDS Tutorial 5.0.0</li>
    
    
    
        
    
    <li>
        <a href="#">Getting Started with the TDS</a>
        <ul>
            
            
            
            <li><a href="tds_tutorial_index.html">TDS Overview</a></li>
            
            
            
            
            
            
            <li><a href="install_java_tomcat.html">Installing Java and Tomcat</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_dir_structure_qt.html">Tomcat Directory Structure</a></li>
            
            
            
            
            
            
            <li><a href="running_tomcat.html">Running Tomcat</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_log_files.html">Tomcat Log Files</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_configuration_files.html">Tomcat Config Files</a></li>
            
            
            
            
            
            
            <li><a href="deploying_the_tds.html">Deploying the TDS</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_manager_app.html">Tomcat Manager Application</a></li>
            
            
            
            
            
            
            <li><a href="where_to_go_from_here.html">Where to go from here</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Client Catalogs</a>
        <ul>
            
            
            
            <li><a href="basic_client_catalog.html">Basic Client Catalog Primer</a></li>
            
            
            
            
            
            
            <li><a href="nested_datasets.html">Nested Datasets</a></li>
            
            
            
            
            
            
            <li><a href="client_catalog_metadata.html">Client Catalog Metadata</a></li>
            
            
            
            
            
            
            <li><a href="client_catalog_references.html">Catalog References</a></li>
            
            
            
            
            
            
            <li><a href="compound_service_elements.html">Compound service elements</a></li>
            
            
            
            
            
            
            <li><a href="client_catalog_xml_validation.html">XML Validation</a></li>
            
            
            
            
            
            
            <li><a href="client_catalog_via_toolsUI.html">Client Catalogs in ToolsUI</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">TDS Configuration</a>
        <ul>
            
            
            
            <li><a href="tds_content_directory.html">TDS Content Directory</a></li>
            
            
            
            
            
            
            <li><a href="default_config_catalog.html">Default TDS Configuration Catalog</a></li>
            
            
            
            
            
            
            <li><a href="basic_config_catalog.html">Basics of Configuration Catalogs</a></li>
            
            
            
            
            
            
            <li><a href="basic_tds_configuration.html">Basic TDS Configuration</a></li>
            
            
            
            
            
            
            <li><a href="adding_ogc_iso_services.html">Adding OGC / ISO Services</a></li>
            
            
            
            
            
            
            <li><a href="adding_ncss.html">Adding the netCDF Subset Service</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Monitoring and Debugging</a>
        <ul>
            
            
            
            <li class="active"><a href="tds_monitoring_and_debugging.html">TDS Monitoring and Debugging</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_and_tds_logs.html">Tomcat and TDS Logs</a></li>
            
            
            
            
            
            
            <li><a href="using_the_tdsmonitor_tool.html">Using the TdsMonitor Tool</a></li>
            
            
            
            
            
            
            <li><a href="third_party_tools.html">3rd Party Tools</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">netCDF Markup Language (NcML)</a>
        <ul>
            
            
            
            <li><a href="tds_basic_ncml_tutorial.html">Basic NcML Tutorial</a></li>
            
            
            
            
            
            
            <li><a href="tds_ncml_aggregation.html">NcML Aggregation</a></li>
            
            
            
            
            
            
            <li><a href="using_ncml_in_the_tds.html">Using NcML in the TDS</a></li>
            
            
            
            
            
            
            <li><a href="basic_ncml_examples.html">Basic NcML Examples</a></li>
            
            
            
            
            
            
            <li><a href="ncml_aggregation_examples.html">NcML Aggregation Examples</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Feature Collections</a>
        <ul>
            
            
            
            <li><a href="feature_collections_ref.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="grib_feature_collections_ref.html">GRIB Feature Collections</a></li>
            
            
            
            
            
            
            <li><a href="grib_feature_collections.html">GRIB Feature Collection Tutorial</a></li>
            
            
            
            
            
            
            <li><a href="grib_files_cdm.html">GRIB Files in CDM</a></li>
            
            
            
            
            
            
            <li><a href="grib_tables_cdm.html">GRIB Tables in CDM</a></li>
            
            
            
            
            
            
            <li><a href="fmrc_ref.html">Forecast Model Run Collections (FMRC)</a></li>
            
            
            
            
            
            
            <li><a href="fmrc_tutorial.html">FMRC Tutorial</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Metadata</a>
        <ul>
            
            
            
            <li><a href="thredds_metadata.html">THREDDS Metadata</a></li>
            
            
            
            
            
            
            <li><a href="iso_metadata.html">ISO Metadata Generation - ncIso</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Production Servers</a>
        <ul>
            
            
            
            <li><a href="production_server_overview.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="troubleshooting_problems.html">Troubleshooting Problems</a></li>
            
            
            
            
            
            
            <li><a href="performance_tips.html">Performance Tips</a></li>
            
            
            
            
            
            
            <li><a href="upgrade_to_5.html">Upgrading to 5.0</a></li>
            
            
            
            
            
            
            <li><a href="installation_checklist.html">Installation Checklist</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">FAQ</a>
        <ul>
            
            
            
            <li><a href="tds_faq.html">FAQ</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Reference Guide</a>
        <ul>
            
            
            
            <li><a href="tds_config_ref.html">TDS Config (threddsConfig.xml)</a></li>
            
            
            
            
            
            
            <li><a href="viewers_ref.html">Viewers</a></li>
            
            
            
            
            
            
            <li><a href="dataset_source_plugin.html">Data Source Plugins</a></li>
            
            
            
            
            
            
            <li><a href="wcs_ref.html">WCS Reference</a></li>
            
            
            
            
            
            
            <li><a href="wms_ref.html">WMS Reference</a></li>
            
            
            
            
            
            
            <li><a href="remote_management_ref.html">Remote Management Reference</a></li>
            
            
            
            
            
            
            <li><a href="netcdf_subset_service_ref.html">Netcdf Subset Service Reference</a></li>
            
            
            
            
            
            
            <li><a href="tds_doc_guide.html">netCDF-Java and TDS Doc Guide</a></li>
            
            
            
            
            
            
            <li><a href="server_side_catalog_specification.html">Server-side Catalog Specification</a></li>
            
            
            
            
            
            
            <li><a href="tds_dataset_scan_ref.html">Configuring TDS with DatasetScan</a></li>
            
            
            
            
            
            
            <li><a href="coverage_datasets.html">Coverage Datasets</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

        <!-- Content Column -->
        <div class="col-md-9">
          <div class="post-header">
   <h1 class="post-title-main">TDS Monitoring and Debugging</h1>
</div>



<div class="post-content">

   

    

    

    

    

  <h2 id="logs">Logs!</h2>

<figure><img class="docimage" src="images/tds/tutorial/monitoring_and_debugging/log.png" alt="Log!" /><figcaption></figcaption></figure>

<p>This section covers log files generated by Tomcat and the TDS for the purposes of monitoring and debugging.</p>

<p>You should be familiar with <a href="install_java_tomcat.html">Tomcat, Java</a>, and <a href="deploying_the_tds.html">TDS</a> installation, as well as basic and advanced TDS configuration.</p>

<h2 id="tomcat-access-logs">Tomcat Access Logs</h2>

<p>The access log records all requests processed by the server.
As of Tomcat 7, enabled in Tomcat by default in <code class="highlighter-rouge">${tomcat_home}/conf/server.xml</code>.
Information it contains is different from other logs in <code class="highlighter-rouge">${tomcat_home}/logs</code>.
Used for monitoring who is using your server and as a way of obtaining “feedback” about the activity and performance of the server.
In order to use the <code class="highlighter-rouge">TdsMonitor</code> tool, you will need to change the default configuration of the <code class="highlighter-rouge">AccessLogValve</code>.</p>

<h3 id="configuring-tomcat-access-logging-for-the-tdsmonitor">Configuring Tomcat access logging for the <code class="highlighter-rouge">TdsMonitor</code></h3>

<p>Modify the <code class="highlighter-rouge">prefix</code>, <code class="highlighter-rouge">suffix</code>, and <code class="highlighter-rouge">pattern</code> attributes of the <code class="highlighter-rouge">AccessLogValve</code> element.</p>

<ol>
  <li>
    <p>Using your favorite editor open <code class="highlighter-rouge">${tomcat_home}/conf/server.xml</code>:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>vi server.xml
</code></pre>
    </div>

    <p>Locate the <code class="highlighter-rouge">AccessLogValve</code> contained in the <code class="highlighter-rouge">Host</code> element (should be near the bottom of the file):</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- Define the default virtual host
        Note: XML Schema validation will not work with Xerces 2.2.
  --&gt;</span>
<span class="nt">&lt;Host</span> <span class="na">name=</span><span class="s">"localhost"</span>  <span class="na">appBase=</span><span class="s">"webapps"</span>
      <span class="na">unpackWARs=</span><span class="s">"true"</span> <span class="na">autoDeploy=</span><span class="s">"true"</span><span class="nt">&gt;</span>

  <span class="c">&lt;!-- SingleSignOn valve, share authentication between web applications
       Documentation at: /docs/config/valve.html --&gt;</span>
  <span class="c">&lt;!--
  &lt;Valve className="org.apache.catalina.authenticator.SingleSignOn" /&gt;
  --&gt;</span>

  <span class="c">&lt;!-- Access log processes all example.
    Documentation at: /docs/config/valve.html
    Note: The pattern used is equivalent to using pattern="common" --&gt;</span>
    <span class="nt">&lt;Valve</span> <span class="na">className=</span><span class="s">"org.apache.catalina.valves.AccessLogValve"</span> <span class="na">directory=</span><span class="s">"logs"</span>
    <span class="na">prefix=</span><span class="s">"localhost_access_log."</span> <span class="na">suffix=</span><span class="s">".txt"</span>
    <span class="na">pattern=</span><span class="s">"%h %l %u %t "</span><span class="err">%r"</span> <span class="err">%s</span> <span class="err">%b"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/Host&gt;</span>
</code></pre>
    </div>

    <p>Change the <code class="highlighter-rouge">prefix</code> and <code class="highlighter-rouge">suffix</code> attributes to customize the access log name. (The <code class="highlighter-rouge">TdsMonitor</code> tool looks for log files to begin with “access”.)</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code>prefix="access."
suffix=".log"
</code></pre>
    </div>

    <p>To provide more useful information about who is accessing the TDS, change the pattern element to customize the format of each log entry:</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code>pattern="%h %l %u %t <span class="ni">&amp;quot;</span>%r<span class="ni">&amp;quot;</span> %s %b <span class="ni">&amp;quot;</span>%{Referer}i<span class="ni">&amp;quot;</span> <span class="ni">&amp;quot;</span>%{User-Agent}i<span class="ni">&amp;quot;</span> %D"
</code></pre>
    </div>

    <p>When you are finished with your edits, the <code class="highlighter-rouge">AccessLogValve</code> should look something like the following:</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;Valve</span> <span class="na">className=</span><span class="s">"org.apache.catalina.valves.AccessLogValve"</span>
   <span class="na">directory=</span><span class="s">"logs"</span>  
   <span class="na">prefix=</span><span class="s">"access."</span>
   <span class="na">suffix=</span><span class="s">".log"</span>
   <span class="na">pattern=</span><span class="s">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b &amp;quot;%{Referer}i&amp;quot; &amp;quot;%{User-Agent}i&amp;quot; %D"</span> <span class="nt">/&gt;</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Verify the changes to the access log have taken affect.
Restart Tomcat and verify an access log has been generated in the <code class="highlighter-rouge">${tomcat_home}/logs/</code> directory:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ls -l /home/tds/workshop/apache-tomcat-7.0.32/logs
-rw-r--r-- 1 tds workshop 0 Jul 24 12:25 access.2013-07-24.log
-rw-r--r-- 1 tds workshop  4270 Jul 24 12:26 catalina.2013-07-24.log
-rw-r--r-- 1 tds workshop 19095 Jul 24 12:26 catalina.out
-rw-r--r-- 1 tds workshop     0 Jul 24 12:25 host-manager.2013-07-24.log
-rw-r--r-- 1 tds workshop  3845 Jul 24 12:26 localhost.2013-07-24.log
-rw-r--r-- 1 tds workshop     0 Jul 15 09:39 localhost_access_log.2013-07-15.txt
-rw-r--r-- 1 tds workshop     0 Jul 24 12:25 manager.2013-07-24.log
</code></pre>
    </div>
  </li>
</ol>

<h3 id="access-log-format">Access log format</h3>

<p>The access log entry format we are using is almost identical to the standard combined logging format with an addition: the %D which is used for documenting the Time taken to process the request, in milliseconds will appear at the end of each log entry:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>pattern="%h %l %u %t <span class="ni">&amp;quot;</span>%r<span class="ni">&amp;quot;</span> %s %b <span class="ni">&amp;quot;</span>%{Referer}i<span class="ni">&amp;quot;</span> <span class="ni">&amp;quot;</span>%{User-Agent}i<span class="ni">&amp;quot;</span> %D"
</code></pre>
</div>

<h3 id="access-log-format-1">Access log format</h3>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 
For more information on access log format configuration, see the Tomcat <a href="http://tomcat.apache.org/tomcat-7.0-doc/config/valve.html">Valve Component</a> Documentation.
</div>

<p>The above pattern makes use of the following codes:</p>

<ul>
  <li><code class="highlighter-rouge">%h</code> - Remote host name (or IP address if resolveHosts is false)</li>
  <li><code class="highlighter-rouge">%l</code> - Remote logical username from identd (always returns ‘-‘)</li>
  <li><code class="highlighter-rouge">%u</code> - Remote user that was authenticated (if any), else ‘-‘</li>
  <li><code class="highlighter-rouge">%t</code> - Date and time, in Common Log Format</li>
  <li><code class="highlighter-rouge">%r</code> - First line of the request (method and request URI)</li>
  <li><code class="highlighter-rouge">%s</code> - HTTP status code of the response</li>
  <li><code class="highlighter-rouge">%b</code> - Bytes sent, excluding HTTP headers, or ‘-‘ if zero</li>
  <li><code class="highlighter-rouge">%D</code> - Time taken to process the request, in millis</li>
</ul>

<p>The above pattern translates into:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>127.0.0.1 - admin <span class="o">[</span>21/Oct/2012:12:31:59 -0600] <span class="s2">"GET /manager/html HTTP/1.1"</span> 200 17578 <span class="s2">"-"</span> <span class="s2">"Mozilla/5.0 (X11; Linux x86_64; rv:10.0.7) Gecko/20120829 Firefox/10.0.7"</span> 8
</code></pre>
</div>

<p>Another way of looking at it:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">pattern</th>
      <th style="text-align: left">meaning</th>
      <th style="text-align: left">value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%h</code></td>
      <td style="text-align: left">Remote host</td>
      <td style="text-align: left">127.0.0.1</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%l</code></td>
      <td style="text-align: left">Remote logical username from identd</td>
      <td style="text-align: left">-</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%u</code></td>
      <td style="text-align: left">Authenticated user</td>
      <td style="text-align: left">admin</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%t</code></td>
      <td style="text-align: left">Time and date of request</td>
      <td style="text-align: left">[21/Oct/2012:12:31:59 -0600]</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%r</code></td>
      <td style="text-align: left">HTTP request method</td>
      <td style="text-align: left">GET</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%r</code></td>
      <td style="text-align: left">Request URI</td>
      <td style="text-align: left">/manager/html</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%r</code></td>
      <td style="text-align: left">Protocol used</td>
      <td style="text-align: left">HTTP/1.1</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%s</code></td>
      <td style="text-align: left">HTTP server response</td>
      <td style="text-align: left">200</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%b</code></td>
      <td style="text-align: left">Bytes transferred</td>
      <td style="text-align: left">17578</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%{Referer}</code></td>
      <td style="text-align: left">Referer</td>
      <td style="text-align: left">-</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%{User-Agent}</code></td>
      <td style="text-align: left">User Agent</td>
      <td style="text-align: left">Mozilla/5.0 (X11; Linux x86_64; rv:10.0.7) Gecko/20120829 Firefox/10.0.7</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">%D</code></td>
      <td style="text-align: left">Response time (in milliseconds)</td>
      <td style="text-align: left">8</td>
    </tr>
  </tbody>
</table>

<h2 id="log-files-generated-by-the-tds">Log Files Generated by the TDS</h2>

<h3 id="introducing-the-tds-logging-directory-tdscontentrootpaththreddslogs">Introducing the TDS logging directory: <code class="highlighter-rouge">${tds.content.root.path}/thredds/logs</code></h3>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 
There are two locations of log files you will reference: <code class="highlighter-rouge">${tomcat_home}/logs/</code> is where you go to look at Tomcat-generated log files, and <code class="highlighter-rouge">${tds.content.root.path}/thredds/logs</code> is where you go to look at TDS-generated log files.
</div>

<p>The log files generated by the TDS are located in the <code class="highlighter-rouge">${tds.content.root.path}/thredds/logs</code> directory:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Log file</th>
      <th style="text-align: left">Data the file contains</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">threddsServlet.log</code></td>
      <td style="text-align: left">log messages used for debugging</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">serverStartup.log</code></td>
      <td style="text-align: left">log messages from the initialization of the TDS</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">models.log</code></td>
      <td style="text-align: left">log messages specific to gridded model data, especially GRIB data</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="highlighter-rouge">cache.log</code></td>
      <td style="text-align: left">log messages related to TDS object and file caching</td>
    </tr>
  </tbody>
</table>

<h3 id="about-the-threddsservletlog">About the threddsServlet.log</h3>

<ul>
  <li>Enabled by default.</li>
  <li>Log messages for all requests handled by the TDS.</li>
  <li>By default is configured to rotate every hour.
Old log files are re-named with the <code class="highlighter-rouge">threddsServlet.log.&lt;yyyy-mm-dd-HH&gt;</code> pattern.</li>
  <li>Used for debugging and troubleshooting issues with the TDS.</li>
  <li>May be asked to send information from <code class="highlighter-rouge">threddsServlet.log</code> to the TDS development team when seeking support.</li>
</ul>

<h3 id="threddsservletlog-log-format">threddsServlet.log log format</h3>

<ol>
  <li>Look at the logging configurations for <code class="highlighter-rouge">threddsServlet.log</code>.
Navigate to the unpacked thredds directory in <code class="highlighter-rouge">${tomcat_home}/webapps/WEB-INF</code>, and view the <code class="highlighter-rouge">log4j.xml</code>:</li>
</ol>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>   <span class="nv">$ </span><span class="nb">cd</span> /home/tds/workshop/apache-tomcat-7.0.32/webapps/thredds/WEB-INF
   <span class="nv">$ </span>less log4j.xml
</code></pre>
</div>

<p>The TDS uses the OpenSource Apache Log4J library (hence, the name of the file: <code class="highlighter-rouge">log4j.xml</code>).</p>

<p>Find the first uncommented Appender element with a name of <code class="highlighter-rouge">threddsServlet</code> and a class of <code class="highlighter-rouge">org.apache.log4j.DailyRollingFileAppender</code>, and note the <code class="highlighter-rouge">ConversionPattern</code>:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>   <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"threddsServlet"</span> <span class="na">class=</span><span class="s">"org.apache.log4j.DailyRollingFileAppender"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"File"</span> <span class="na">value=</span><span class="s">"${tds.log.dir}/threddsServlet.log"</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"DatePattern"</span> <span class="na">value=</span><span class="s">".yyyy-MM-dd-HH"</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;layout</span> <span class="na">class=</span><span class="s">"org.apache.log4j.PatternLayout"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"ConversionPattern"</span> <span class="na">value=</span><span class="s">"%d{yyyy-MM-dd'T'HH:mm:ss.SSS Z} [%10r][%8X{ID}] %-5p - %c - %m%n"</span><span class="nt">/&gt;</span>
       <span class="c">&lt;!--param name="ConversionPattern" value="%d{ISO8601} [%10r - %10X{ID}] %-5p - %c - %m%n"/--&gt;</span>
     <span class="nt">&lt;/layout&gt;</span>
   <span class="nt">&lt;/appender&gt;</span>
</code></pre>
</div>

<ol>
  <li>
    <p>Examine the log format being applied to the <code class="highlighter-rouge">threddsServlet.log</code> file.
The ConversionPattern parameter specifies the Log4J pattern used to format the entries of the <code class="highlighter-rouge">threddsServlet.log</code> file:</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code>value="%d{yyyy-MM-dd'T'HH:mm:ss.SSS Z} [%10r][%8X{ID}] %-5p - %c - %m%n"
</code></pre>
    </div>

    <p>The above pattern makes use of the following Log4J codes:</p>

    <ul>
      <li><code class="highlighter-rouge">%d{yyyy-MM-dd'T'HH:mm:ss.SSS Z}</code> - Date and time</li>
      <li><code class="highlighter-rouge">%10r</code> - Time, in milliseconds, since Tomcat startup</li>
      <li><code class="highlighter-rouge">%8X{ID}</code> - Transaction ID</li>
      <li><code class="highlighter-rouge">%-5p</code> - Logging level (options are DEBUG, INFO, WARN, ERROR, and FATAL)</li>
      <li><code class="highlighter-rouge">%c</code> - Location in the TDS code where the message was generated</li>
      <li><code class="highlighter-rouge">%m</code> - Content of the log message</li>
      <li><code class="highlighter-rouge">%n</code> - Newline character</li>
    </ul>

    <p>The above pattern translates into:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>2012-10-21T12:26:23.727 -0600 <span class="o">[</span>      5887][       8] INFO  - threddsServlet - Remote host: 127.0.0.1 - Request: <span class="s2">"GET /thredds/catalog/testAll/catalog.html?dataset=testDatasetScan/2004050412_eta_211.nc HTTP/1.1"</span>
</code></pre>
    </div>

    <p>Another way of looking at it:</p>

    <table>
      <thead>
        <tr>
          <th style="text-align: left">pattern</th>
          <th style="text-align: left">meaning</th>
          <th style="text-align: left">value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: left"><code class="highlighter-rouge">%d{yyyy-MM-dd'T'HH:mm:ss.SSS Z}</code></td>
          <td style="text-align: left">Date and time</td>
          <td style="text-align: left">2012-10-21T12:26:23.727 -0600</td>
        </tr>
        <tr>
          <td style="text-align: left"><code class="highlighter-rouge">%10r</code></td>
          <td style="text-align: left">The number of milliseconds since the server was started</td>
          <td style="text-align: left">[ 5887]</td>
        </tr>
        <tr>
          <td style="text-align: left"><code class="highlighter-rouge">%8X{ID}</code></td>
          <td style="text-align: left">Request ID</td>
          <td style="text-align: left">[ 8]</td>
        </tr>
        <tr>
          <td style="text-align: left"><code class="highlighter-rouge">%-5p</code></td>
          <td style="text-align: left">Logging level</td>
          <td style="text-align: left">INFO</td>
        </tr>
        <tr>
          <td style="text-align: left"><code class="highlighter-rouge">%c</code></td>
          <td style="text-align: left">Location in the TDS code where the message was generated</td>
          <td style="text-align: left">threddsServlet</td>
        </tr>
        <tr>
          <td style="text-align: left"><code class="highlighter-rouge">%m</code></td>
          <td style="text-align: left">Content of the log message</td>
          <td style="text-align: left">Remote host: 127.0.0.1 - Request: “GET  /thredds/catalog/testAll/catalog.html?dataset=testDatasetScan/2004050412_eta_211.nc HTTP/1.1”</td>
        </tr>
      </tbody>
    </table>

    <div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 
For more information on the <code class="highlighter-rouge">Log4J</code> library, consult the online <a href="https://logging.apache.org/log4j/2.x/">documentation</a>.
</div>
  </li>
</ol>

<h2 id="transaction-bracketing-in-threddsservletlog">Transaction bracketing in <code class="highlighter-rouge">threddsServlet.log</code></h2>

<ul>
  <li>Each HTTP request (or transaction) handled by the TDS results in at least two log messages:
    <ul>
      <li>a message indicating the <strong>start of the transaction</strong></li>
      <li>a message indicating the <strong>end of the transaction</strong>.</li>
    </ul>
  </li>
  <li>Between the start and end messages, there may be other entries for this same request (e.g., <code class="highlighter-rouge">DEBUG</code>, <code class="highlighter-rouge">WARN</code>, <code class="highlighter-rouge">ERROR</code>, etc.).</li>
  <li>All log messages for the same request will have the same request ID.</li>
  <li>Log messages from multiple requests can be interspersed in the log file.</li>
  <li>When tracking down an error, it is useful to find a specific example of a request that causes that error and extract all the log messages for that request.</li>
</ul>

<h3 id="start-of-transaction">Start of transaction</h3>

<p>The main message in a start of transaction log message includes:</p>

<ul>
  <li>IP address of the requester; and</li>
  <li>request being made.</li>
</ul>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>... Remote host: 128.117.140.75 - Request: <span class="s2">"GET /thredds/catalog.html HTTP/1.1"</span>
</code></pre>
</div>

<h3 id="end-of-transaction">End of transaction</h3>

<p>The main message in a end of transaction log message includes:</p>

<ul>
  <li>server response code for the response;</li>
  <li>size of the response body in bytes; and</li>
  <li>time (in milliseconds) to handle the request.</li>
</ul>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>... Request Completed - 200 - 3403 - 1
</code></pre>
</div>

<p>Most end of transaction messages include a status code that matches a standard HTTP status code. However, when the client breaks the connection or a request is forwarded to another TDS internal service, one of three TDS specific status codes are used:</p>

<ul>
  <li><code class="highlighter-rouge">1000 (Client Abort)</code> - the connection to the client was broken;</li>
  <li><code class="highlighter-rouge">1001 (Forwarded)</code> - the request was forwarded to another TDS internal service; or</li>
  <li><code class="highlighter-rouge">1002 (Forward Failed)</code> - an attempt was made but failed to forward the request to another TDS internal service.</li>
</ul>

<p>If the request is forwarded successfully, another set of transaction messages should be initiated with the ending message containing a standard HTTP status code. If forwarding the request fails, another set of transaction message may or may not be initiated and the entry in the access log will probably either log a 404 (File Not Found) or a 500 (Internal Server Error) HTTP status code.</p>

<h3 id="looking-at-threddsservletlog-data">Looking at threddsServlet.log data</h3>

<p>Here is an example of some log messages from a request that resulted in error messages:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>2013-07-22T09:21:02.229 -0600 <span class="o">[</span>1114883517][ 7948911] INFO  - threddsServlet - Remote host: 173.165.244.157 - Request: <span class="s2">"GET /thredds/wms/grib/NCEP/GFS/Global_0p5deg/GFS-Global_0p5deg-20130722/best2013-07-22T12:00:00Z?
LAYERS=Temperature_isobaric&amp;FORMAT=image%2Fpng&amp;TRANSPARENT=TRUE&amp;VERSION=1.3.0&amp;STYLES=boxfill2Frainbow&amp;COLOR
SCALERANGE=270%2C315&amp;ELEVATION=100000&amp;EXCEPTIONS=INIMAGE&amp;SERVICE=WMS&amp;REQUEST=GetMap&amp;TIME=2013-07-22T12%3A00
%3A00.000Z&amp;CRS=EPSG%3A3857&amp;BBOX=-10644926.305625,5635549.220625,-10331840.237812,5948635.2884375&amp;WIDTH=256&amp;
HEIGHT=256 HTTP/1.1"</span>

2013-07-22T09:21:02.233 -0600 <span class="o">[</span>1114883521][ 7948912] INFO  - threddsServlet - Remote host: 173.165.244.157 - Request: <span class="s2">"GET /thredds/wms/grib/NCEP/GFS/Global_0p5deg/GFS-Global_0p5deg-20130722/best2013-07-22T12:00:00Z?LAYERS=Temperature_isobaric&amp;FORMAT=image%2Fpng&amp;TRANSPARENT=TRUE&amp;VERSION=1.3.0&amp;STYLES=boxfill2Frainbow&amp;COLOR
SCALERANGE=270%2C315&amp;ELEVATION=100000&amp;EXCEPTIONS=INIMAGE&amp;SERVICE=WMS&amp;REQUEST=GetMap&amp;TIME=2013-07-22T12%3A00
%3A00.000Z&amp;CRS=EPSG%3A3857&amp;BBOX=-10644926.305625,5322463.1528125,-10331840.237812,5635549.220625&amp;WIDTH=256&amp;
HEIGHT=256 HTTP/1.1"</span>

2013-07-22T09:21:02.247 -0600 <span class="o">[</span>1114883535][ 7948897] INFO  - threddsServlet - Request Completed - 200 - -1 - 186

2013-07-22T09:21:02.364 -0600 <span class="o">[</span>1114883652][ 7948900] INFO  - threddsServlet - Request Completed - 200 - -1 - 221

2013-07-22T09:21:02.376 -0600 <span class="o">[</span>1114883664][ 7948913] INFO  - threddsServlet - Remote host: 68.16.167.238 - Request: <span class="s2">"GET /thredds/catalog/nexrad/level2/KDGX/20130722/latest.xml HTTP/1.1"</span>

2013-07-22T09:21:03.110 -0600 <span class="o">[</span>1114884398][ 7948914] INFO  - threddsServlet - Remote host: 96.126.114.65 - Request: <span class="s2">"GET /thredds/fileServer//nexrad/level3/NST/AMA/20130722/Level3_AMA_NST_20130722_0032.nids HTTP/1.0"</span>

2013-07-22T09:21:03.128 -0600 <span class="o">[</span>1114884416][ 7948914] INFO  - threddsServlet - Request Completed - 200 - 519 - 18

2013-07-22T09:21:03.174 -0600 <span class="o">[</span>1114884462][ 7948915] INFO  - threddsServlet - Remote host: 96.126.114.65 - Request: <span class="s2">"GET /thredds/fileServer//nexrad/level3/NST/HGX/20130722/Level3_HGX_NST_20130722_1515.nids HTTP/1.0"</span>

2013-07-22T09:21:03.181 -0600 <span class="o">[</span>1114884469][ 7948915] INFO  - threddsServlet - Request Completed - 200 - 525 - 7

2013-07-22T09:21:03.190 -0600 <span class="o">[</span>1114884478][ 7948911] ERROR - thredds.server.wms.ThreddsWmsController - dispatchWmsRequest<span class="o">()</span>: IOException:
java.io.IOException: java.lang.NullPointerException
        at thredds.server.wms.ThreddsScalarLayer.readHorizontalPoints<span class="o">(</span>ThreddsScalarLayer.java:189<span class="o">)</span>
        at uk.ac.rdg.resc.ncwms.controller.AbstractWmsController.readDataGrid<span class="o">(</span>AbstractWmsController.java:1365<span class="o">)</span>
        at uk.ac.rdg.resc.ncwms.controller.AbstractWmsController.getMap<span class="o">(</span>AbstractWmsController.java:515<span class="o">)</span>
        at thredds.server.wms.ThreddsWmsController.dispatchWmsRequest<span class="o">(</span>ThreddsWmsController.java:179<span class="o">)</span>
...
        at java.lang.Thread.run<span class="o">(</span>Thread.java:722<span class="o">)</span>
Caused by: java.lang.NullPointerException

2013-07-22T09:21:03.199 -0600 <span class="o">[</span>1114884487][ 7948913] INFO  - threddsServlet - Request Completed - 200 - -1 - 823

2013-07-22T09:21:03.200 -0600 <span class="o">[</span>1114884488][ 7948916] INFO  - threddsServlet - Remote host: 96.126.114.65 - Request: <span class="s2">"GET /thredds/fileServer//nexrad/level3/NST/MLB/20130722/Level3_MLB_NST_20130722_1517.nids HTTP/1.0"</span>

2013-07-22T09:21:03.200 -0600 <span class="o">[</span>1114884488][ 7948903] INFO  - threddsServlet - Request Completed - 200 - -1 - 1045

2013-07-22T09:21:03.206 -0600 <span class="o">[</span>1114884494][ 7948916] INFO  - threddsServlet - Request Completed - 200 - 1058 - 6

2013-07-22T09:21:03.229 -0600 <span class="o">[</span>1114884517][ 7948911] INFO  - threddsServlet - Request Completed - 500 - -1 - 1000
</code></pre>
</div>

<p>In the above example, note:</p>

<ul>
  <li>the request ID (7948911) appears in three locations;</li>
  <li>the <code class="highlighter-rouge">ERROR</code> message contains a stack trace; and</li>
  <li>the status code in the end of transaction message is <code class="highlighter-rouge">500 (Internal Server Error)</code>.</li>
</ul>

<div class="alert alert-warning" role="alert"><i class="fa fa-warning"></i> <b>Important:</b> 
Log messages from multiple requests can be interspersed in the log file.
</div>


    <div class="tags">
        
    </div>

    

</div>

        </div>
      </div>
      <footer>
  <div class="row is-flex">
    <div class="col-sm-3">
      <div class="triptych-left">
        <div class="footer-logos">
          <a class="noicon" href="https://unidata.ucar.edu/software/tds/"> <img alt="TDS" src="images/thredds_tds-32x32.png"/></a>
        </div>
        <p class="triptych-header">THREDDS</p>
        <ul>
          <li>
            
            <span>Page last updated:<br /></span> April 2, 2018
            
          </li>
          <li>
            Documentation site last generated:<br /> April 19, 2018
          </li>
        </ul>
      </div>
    </div>

    <div class="col-sm-6">
      <div class="triptych-center">
        <div class="footer-logos">
          <a class="noicon" href="https://www.nsf.gov/"> <img alt="NSF" src="images/nsf_logo_transparent.png"/></a>
        </div>
        <div class="footer-logos" style="padding-right: 1em;">
          <a class="noicon" href="https://www.ucp.ucar.edu"> <img alt="UCP" src="images/ucp-logo2_transparent.png"/></a>
        </div>
        <p class="triptych-header">Unidata</p>
          <p class="triptych-center">
            Unidata is a member of the
            <a href="https://www.ucp.ucar.edu/">UCAR Community Programs</a>, managed by the
            <a href="https://www.ucar.edu">University Corporation for Atmospheric Research</a>, and funded by the
            <a href="https://www.nsf.gov">National Science Foundation</a>.
          </p>
          <p class="triptych-center">
            Read Unidata's
            <a href="https://www.unidata.ucar.edu/legal/participation.html">Participation Policy</a>.
          </p>
            <table class="triptych-center">
              <tr>
                <td style="width:33%;text-align:left;">&copy;2018 UCAR</td>
                <td style="width:33%;text-align:center;">
                  <a href="https://www2.ucar.edu/privacy-policy">Privacy Policy</a>
                </td>
                <td style="width:33%;text-align:right;">
                  <a href="https://www2.ucar.edu/terms-of-use">Terms of Use</a>
                </td>
              </tr>
            </table>
      </div>
    </div>

    <div class="col-sm-3">
      <div class="triptych-right">
        <div class="footer-logos">
          <a class="noicon" href="https://unidata.ucar.edu/"> <img alt="TDS" src="images/unilogo-32x32.png"/></a>
        </div>
        <p class="triptych-header">Contact Unidata</p>
        <ul>
          <li>
            For support:
              <a href="mailto:support@unidata.ucar.edu">support@unidata.ucar.edu</a>
          </li>
          <li>
            By
              <a href="https://www.unidata.ucar.edu/about/index.html#visit">postal mail</a>
            or
              <a href="https://www.unidata.ucar.edu/about/index.html#visit">in person</a>
          </li>
          <li>
            About this website:
              <a href="mailto:plaza@unidata.ucar.edu">plaza@unidata.ucar.edu</a>
          </li>
          <li>
            By telephone:
            303.497.8643
          </li>
        </ul>

      </div>
    </div>

  </div>
</footer>

    </div>
    <!-- /.row -->
  </div>
  <!-- /.container -->
</body>
 <!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-92978945-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>
 

</html>
