<!DOCTYPE html>
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Upgrading to CDM / TDS version 5 | THREDDS Documentation</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-unidata.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="www.unidata.ucar.edufeed.xml">

  <script>
    $(document).ready(function() {
      // Initialize navgoco with default options
      $("#mysidebar").navgoco({
        caretHtml: '',
        accordion: true,
        openClass: 'active', // open
        save: false, // leave false or nav highlighting doesn't work right
        cookie: {
          name: 'navgoco',
          expires: false,
          path: '/'
        },
        slide: {
          duration: 400,
          easing: 'swing'
        }
      });

      $("#collapseAll").click(function(e) {
        e.preventDefault();
        $("#mysidebar").navgoco('toggle', false);
      });

      $("#expandAll").click(function(e) {
        e.preventDefault();
        $("#mysidebar").navgoco('toggle', true);
      });

    });
  </script>
  <script>
    $(function() {
      $('[data-toggle="tooltip"]').tooltip()
    })
  </script>
  

</head>

<body>
  <!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> THREDDS Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">THREDDS Source<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/Unidata/THREDDS" target="_blank">netCDF-Java and TDS Github Repo</a></li>
                        
                        
                        
                        <li><a href="https://github.com/Unidata/Rosetta" target="_blank">Rosetta Github Repo</a></li>
                        
                        
                        
                        <li><a href="https://github.com/Unidata/siphon" target="_blank">Siphon Github Repo</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorial<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="tds_tutorial_index.html">THREDDS Data Server Tutorial</a></li>
                        
                        
                        
                        <li><a href="netcdf_java_tutorial_index.html">netCDF-Java Tutorial</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Docs<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://www.unidata.ucar.edu/software/rosetta/docs/" target="_blank">Rosetta</a></li>
                        
                        
                        
                        <li><a href="https://siphon.readthedocs.io/en/latest/#" target="_blank">Siphon</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
			<li><a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:support-thredds@unidata.ucar.edu?subject=THREDDS Documentation Feedback f eedback&body=I have some feedback about the Upgrading to CDM / TDS version 5 page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a><li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Upgrading to CDM / TDS version 5">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

  <!-- Page Content -->
  <div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
      <!-- Sidebar Column -->
      <div class="col-md-3">

        







<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">TDS Tutorial 5.0.0</li>
    
    
    
        
    
    <li>
        <a href="#">Getting Started with the TDS</a>
        <ul>
            
            
            
            <li><a href="tds_tutorial_index.html">TDS Overview</a></li>
            
            
            
            
            
            
            <li><a href="install_java_tomcat.html">Installing Java and Tomcat</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_dir_structure_qt.html">Tomcat Directory Structure</a></li>
            
            
            
            
            
            
            <li><a href="running_tomcat.html">Running Tomcat</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_log_files.html">Tomcat Log Files</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_configuration_files.html">Tomcat Config Files</a></li>
            
            
            
            
            
            
            <li><a href="deploying_the_tds.html">Deploying the TDS</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_manager_app.html">Tomcat Manager Application</a></li>
            
            
            
            
            
            
            <li><a href="where_to_go_from_here.html">Where to go from here</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Client Catalogs</a>
        <ul>
            
            
            
            <li><a href="basic_client_catalog.html">Basic Client Catalog Primer</a></li>
            
            
            
            
            
            
            <li><a href="nested_datasets.html">Nested Datasets</a></li>
            
            
            
            
            
            
            <li><a href="client_catalog_metadata.html">Client Catalog Metadata</a></li>
            
            
            
            
            
            
            <li><a href="client_catalog_references.html">Catalog References</a></li>
            
            
            
            
            
            
            <li><a href="compound_service_elements.html">Compound service elements</a></li>
            
            
            
            
            
            
            <li><a href="client_catalog_xml_validation.html">XML Validation</a></li>
            
            
            
            
            
            
            <li><a href="client_catalog_via_toolsUI.html">Client Catalogs in ToolsUI</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">TDS Configuration</a>
        <ul>
            
            
            
            <li><a href="tds_content_directory.html">TDS Content Directory</a></li>
            
            
            
            
            
            
            <li><a href="default_config_catalog.html">Default TDS Configuration Catalog</a></li>
            
            
            
            
            
            
            <li><a href="basic_config_catalog.html">Basics of Configuration Catalogs</a></li>
            
            
            
            
            
            
            <li><a href="basic_tds_configuration.html">Basic TDS Configuration</a></li>
            
            
            
            
            
            
            <li><a href="adding_ogc_iso_services.html">Adding OGC / ISO Services</a></li>
            
            
            
            
            
            
            <li><a href="adding_ncss.html">Adding the netCDF Subset Service</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Monitoring and Debugging</a>
        <ul>
            
            
            
            <li><a href="tds_monitoring_and_debugging.html">TDS Monitoring and Debugging</a></li>
            
            
            
            
            
            
            <li><a href="tomcat_and_tds_logs.html">Tomcat and TDS Logs</a></li>
            
            
            
            
            
            
            <li><a href="using_the_tdsmonitor_tool.html">Using the TdsMonitor Tool</a></li>
            
            
            
            
            
            
            <li><a href="third_party_tools.html">3rd Party Tools</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">netCDF Markup Language (NcML)</a>
        <ul>
            
            
            
            <li><a href="tds_basic_ncml_tutorial.html">Basic NcML Tutorial</a></li>
            
            
            
            
            
            
            <li><a href="tds_ncml_aggregation.html">NcML Aggregation</a></li>
            
            
            
            
            
            
            <li><a href="using_ncml_in_the_tds.html">Using NcML in the TDS</a></li>
            
            
            
            
            
            
            <li><a href="basic_ncml_examples.html">Basic NcML Examples</a></li>
            
            
            
            
            
            
            <li><a href="ncml_aggregation_examples.html">NcML Aggregation Examples</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Feature Collections</a>
        <ul>
            
            
            
            <li><a href="feature_collections_ref.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="grib_feature_collections_ref.html">GRIB Feature Collections</a></li>
            
            
            
            
            
            
            <li><a href="grib_feature_collections.html">GRIB Feature Collection Tutorial</a></li>
            
            
            
            
            
            
            <li><a href="grib_files_cdm.html">GRIB Files in CDM</a></li>
            
            
            
            
            
            
            <li><a href="grib_tables_cdm.html">GRIB Tables in CDM</a></li>
            
            
            
            
            
            
            <li><a href="fmrc_ref.html">Forecast Model Run Collections (FMRC)</a></li>
            
            
            
            
            
            
            <li><a href="fmrc_tutorial.html">FMRC Tutorial</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Metadata</a>
        <ul>
            
            
            
            <li><a href="thredds_metadata.html">THREDDS Metadata</a></li>
            
            
            
            
            
            
            <li><a href="iso_metadata.html">ISO Metadata Generation - ncIso</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Production Servers</a>
        <ul>
            
            
            
            <li><a href="production_server_overview.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="troubleshooting_problems.html">Troubleshooting Problems</a></li>
            
            
            
            
            
            
            <li><a href="performance_tips.html">Performance Tips</a></li>
            
            
            
            
            
            
            <li class="active"><a href="upgrade_to_5.html">Upgrading to 5.0</a></li>
            
            
            
            
            
            
            <li><a href="installation_checklist.html">Installation Checklist</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">FAQ</a>
        <ul>
            
            
            
            <li><a href="tds_faq.html">FAQ</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Reference Guide</a>
        <ul>
            
            
            
            <li><a href="tds_config_ref.html">TDS Config (threddsConfig.xml)</a></li>
            
            
            
            
            
            
            <li><a href="viewers_ref.html">Viewers</a></li>
            
            
            
            
            
            
            <li><a href="dataset_source_plugin.html">Data Source Plugins</a></li>
            
            
            
            
            
            
            <li><a href="wcs_ref.html">WCS Reference</a></li>
            
            
            
            
            
            
            <li><a href="wms_ref.html">WMS Reference</a></li>
            
            
            
            
            
            
            <li><a href="remote_management_ref.html">Remote Management Reference</a></li>
            
            
            
            
            
            
            <li><a href="netcdf_subset_service_ref.html">Netcdf Subset Service Reference</a></li>
            
            
            
            
            
            
            <li><a href="tds_doc_guide.html">netCDF-Java and TDS Doc Guide</a></li>
            
            
            
            
            
            
            <li><a href="server_side_catalog_specification.html">Server-side Catalog Specification</a></li>
            
            
            
            
            
            
            <li><a href="tds_dataset_scan_ref.html">Configuring TDS with DatasetScan</a></li>
            
            
            
            
            
            
            <li><a href="coverage_datasets.html">Coverage Datasets</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

        <!-- Content Column -->
        <div class="col-md-9">
          <div class="post-header">
   <h1 class="post-title-main">Upgrading to CDM / TDS version 5</h1>
</div>



<div class="post-content">

   

    

    

    

    

  <h2 id="requirements">Requirements</h2>

<ul>
  <li>Java 8 is now required</li>
  <li>Tomcat 8 (servlet 3.1)</li>
  <li>
    <p>On the command line when starting up Tomcat/TDS, you must specify <code class="highlighter-rouge">-Dtds.content.root.path=&lt;content root&gt;</code> where <code class="highlighter-rouge">&lt;content root&gt;</code> points to the top of the content directory.
Note that this is <code class="highlighter-rouge">${tomcat_home}/content/</code>, not<code class="highlighter-rouge">${tomcat_home}/content/thredds/</code>. Don’t forget the trailing slash. For example:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code>-Dtds.content.root.path<span class="o">=</span>/opt/tomcat-home/content/
</code></pre>
    </div>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<p>The configuration catalogs and internal state of the TDS has been extensively reworked to be able to scale to large numbers of catalogs, datasets, and internal objects without excessive use of memory.
A running TDS can be triggered to reread the configuration catalogs without having to restart.
It can be configured to reread only changed catalogs, for fast incremental updates. Other features have been added to make writing configuration catalogs more maintainable, including the <code class="highlighter-rouge">&lt;catalogScan&gt;</code> element, and default and standard services.</p>

<p>The other major enhancement is that <code class="highlighter-rouge">GridDataset</code> is replaced by <code class="highlighter-rouge">FeatureDatasetCoverage</code>, to better support very large feature collections.
The Coverage API works with <em>coordinate  values</em> (not <em>array indices</em>), which solves various intractable problems that arise when using array index subsetting on large collections.</p>

<p>A number of API enhancements have been made to take advantage of evolution in the Java language, for example <em>try-with-resource</em> and <em>foreach</em> constructs.
The use of these make code simpler and more reliable.</p>

<p>Deprecated classes and methods have been removed, and the module structure and third-party jar use has been improved.</p>

<h2 id="api-changes">API Changes</h2>

<h3 id="unsigned-types">Unsigned Types</h3>

<ul>
  <li><code class="highlighter-rouge">DataType</code> now has unsigned types: <code class="highlighter-rouge">UBYTE</code>, <code class="highlighter-rouge">USHORT</code>, <code class="highlighter-rouge">UINT</code>, <code class="highlighter-rouge">ULONG</code></li>
  <li><code class="highlighter-rouge">Array</code>, <code class="highlighter-rouge">ArrayScalar</code>, <code class="highlighter-rouge">ArrayByte</code>, <code class="highlighter-rouge">ArrayInt</code>, <code class="highlighter-rouge">ArrayShort</code>, <code class="highlighter-rouge">ArrayLong</code> factory and constructor methods now require <code class="highlighter-rouge">isUnsigned</code> parameter.</li>
  <li><code class="highlighter-rouge">Array.factory(class, shape)</code> → <code class="highlighter-rouge">Array.factory(DataType, shape)</code> or <code class="highlighter-rouge">Array.factory(dataType, class, shape)</code></li>
  <li><code class="highlighter-rouge">Array.get1DJavaArray(Class)</code> → <code class="highlighter-rouge">Array.get1DJavaArray(DataType)</code> or <code class="highlighter-rouge">Array.get1DJavaArray(Class, isUnsigned)</code></li>
  <li>Remove <code class="highlighter-rouge">Array.setUnsigned()</code>, <code class="highlighter-rouge">Variable.setUnsigned()</code></li>
  <li><code class="highlighter-rouge">Variable.getUnsigned()</code> → <code class="highlighter-rouge">Variable.getDataType().getUnsigned()</code></li>
  <li><code class="highlighter-rouge">new Attribute(String name, List values)</code> → <code class="highlighter-rouge">new Attribute(String name, List values, boolean isUnsigned)</code></li>
  <li><code class="highlighter-rouge">StructureDataScalar.addMember(String name, String desc, String units, DataType dtype, boolean isUnsigned, Number val)</code> → <code class="highlighter-rouge">StructureDataScalar.addMember(String name, String desc, String units, DataType dtype, Number val)</code></li>
</ul>

<h3 id="variable-length-vlen-dimensions-and-variables">Variable Length (vlen) Dimensions and Variables</h3>

<ul>
  <li>The CDM data model is clarified to allow <em>vlen</em> dimensions only in the outermost (fastest changing) Dimension.</li>
  <li>Reading a Variable with only a single <em>vlen</em> Dimension will result in a regular Array.</li>
  <li>Reading a Variable with a nested <em>vlen</em> Dimension will result in an ArrayObject containing regular Arrays of independent lengths.</li>
  <li>In both cases the returned array’s <code class="highlighter-rouge">DataType</code> will be the primitive type.</li>
  <li>Previously the exact Array class and DataType returned from a read on a vlen was not well-defined.</li>
  <li>Use <code class="highlighter-rouge">Array.isVlen()</code> to discover if an Array represents vlen data.</li>
  <li><code class="highlighter-rouge">ArrayObject.factory(Class classType, Index index)</code> is now <code class="highlighter-rouge">ArrayObject.factory(DataType dtype, Class classType, boolean isVlen, Index index)</code></li>
  <li>Use <code class="highlighter-rouge">Array.makeVlenArray(int[] shape, Array[] data)</code> to construct <em>vlen</em> data.</li>
  <li>See <a href="variable_length_data.html">here</a> for more information.</li>
</ul>

<h3 id="autocloseable">AutoCloseable</h3>

<p><em>AutoCloseable</em> was introduced in Java 7, along with the <em>try-with-resources</em> language feature.
Use of this feature makes code more readable and more reliable in ensuring that resources (like file handles) are released when done.
We strongly recommend that you modify your code to take advantage of it wherever possible.
For example:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code> <span class="k">try</span> <span class="o">(</span><span class="n">NetcdfFile</span> <span class="n">ncfile</span> <span class="o">=</span> <span class="n">NetcdfFile</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">location</span><span class="o">))</span> <span class="o">{</span>
    <span class="o">...</span>
 <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ioe</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// handle ioe here, or propagate by not using catch clause</span>
 <span class="o">}</span>
</code></pre>
</div>

<ul>
  <li>The following now implement <em>AutoCloseable</em>, so can be the target of <em>try-with-resource</em>:</li>
  <li><code class="highlighter-rouge">NetcdfFile</code>, <code class="highlighter-rouge">NetcdfFileWriter</code></li>
  <li><code class="highlighter-rouge">HTTPMethod</code>, <code class="highlighter-rouge">HTTPSession</code></li>
  <li><code class="highlighter-rouge">FeatureDataset</code>, <code class="highlighter-rouge">CoverageDataset</code>, <code class="highlighter-rouge">CoverageDatasetCollection</code></li>
  <li><code class="highlighter-rouge">CFPointWriter</code>, <code class="highlighter-rouge">Grib2NetcdfFile</code></li>
  <li>ArrayStructure (deprecate <em>finish()</em>)</li>
  <li><code class="highlighter-rouge">PointFeatureCollectionIterator</code> (<code class="highlighter-rouge">finish()</code> method now deprecated)</li>
  <li><code class="highlighter-rouge">StructureDataIterator</code>, <code class="highlighter-rouge">PointFeatureIterator</code>, <code class="highlighter-rouge">PointFeatureCollectionIterator</code>, <code class="highlighter-rouge">NestedPointFeatureCollectionIterator</code></li>
  <li><code class="highlighter-rouge">thredds.client.catalog.tools.DataFactory.Result</code></li>
</ul>

<h3 id="iterable">Iterable</h3>

<p><em>Iterable</em> was introduced in Java 7, along with the <em>foreach</em> language feature, and makes code more readable with less boilerplate.
For example:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="n">StructureData</span> <span class="n">sdata</span> <span class="o">:</span> <span class="n">myArrayStructure</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre>
</div>

<ul>
  <li>The following now implement <code class="highlighter-rouge">Iterable&lt;&gt;</code>, and so can be the target of <em>foreach</em>:</li>
  <li><code class="highlighter-rouge">Range</code> implements <code class="highlighter-rouge">Iterable&lt;Integer&gt;</code> (replace <code class="highlighter-rouge">first()</code>, <code class="highlighter-rouge">last()</code>, <code class="highlighter-rouge">stride()</code> methods)</li>
  <li><code class="highlighter-rouge">ArrayStructure</code> implements <code class="highlighter-rouge">Iterable&lt;StructureData&gt;</code> (replace <code class="highlighter-rouge">getStructureDataIterator()</code> method)</li>
  <li><code class="highlighter-rouge">PointFeatureIterator</code> extends <code class="highlighter-rouge">Iterator&lt;PointFeature&gt;</code>  (<code class="highlighter-rouge">finish()</code> method deprecated)</li>
  <li>In order for <code class="highlighter-rouge">PointFeatureIterator</code> to implement <code class="highlighter-rouge">Iterator&lt;PointFeature&gt;</code>, the <code class="highlighter-rouge">hasNext()</code> and <code class="highlighter-rouge">next()</code> methods cannot throw <code class="highlighter-rouge">IOException</code>.
The interface is changed to remove <code class="highlighter-rouge">throws IOException</code>, which will now be wrapped in <code class="highlighter-rouge">RuntimeException</code>.</li>
  <li><code class="highlighter-rouge">PointFeatureCollection</code> implements <code class="highlighter-rouge">Iterable&lt;PointFeature&gt;</code> (replace <code class="highlighter-rouge">hasNext()</code>, <code class="highlighter-rouge">next()</code>, <code class="highlighter-rouge">finish()</code>, <code class="highlighter-rouge">resetIteration()</code> methods)</li>
  <li><code class="highlighter-rouge">StationTimeSeriesFeatureCollection</code> implements <code class="highlighter-rouge">Iterable&lt;StationTimeSeriesFeature&gt;</code> (replace <code class="highlighter-rouge">hasNext()</code>, <code class="highlighter-rouge">next()</code>, <code class="highlighter-rouge">finish()</code>, <code class="highlighter-rouge">resetIteration()</code> methods)</li>
  <li><code class="highlighter-rouge">ProfileFeatureCollection</code> implements <code class="highlighter-rouge">Iterable&lt;ProfileFeature&gt;</code> (replace <code class="highlighter-rouge">hasNext()</code>, <code class="highlighter-rouge">next()</code>, <code class="highlighter-rouge">finish()</code>, <code class="highlighter-rouge">resetIteration()</code> methods)</li>
  <li><code class="highlighter-rouge">TrajectoryFeatureCollection</code> implements <code class="highlighter-rouge">Iterable&lt;TrajectoryFeature&gt;</code> (replace <code class="highlighter-rouge">hasNext()</code>, <code class="highlighter-rouge">next()</code>, <code class="highlighter-rouge">finish()</code>, <code class="highlighter-rouge">resetIteration()</code> methods)</li>
  <li><code class="highlighter-rouge">StationProfileFeature</code> implements <code class="highlighter-rouge">Iterable&lt;ProfileFeature&gt;</code> (replace <code class="highlighter-rouge">hasNext()</code>, <code class="highlighter-rouge">next()</code>, <code class="highlighter-rouge">finish()</code>, <code class="highlighter-rouge">resetIteration()</code> methods)</li>
  <li><code class="highlighter-rouge">StationProfileFeatureCollection</code> implements <code class="highlighter-rouge">Iterable&lt;StationProfileFeature&gt;</code> (replace <code class="highlighter-rouge">hasNext()</code>, <code class="highlighter-rouge">next()</code>, <code class="highlighter-rouge">finish()</code>, <code class="highlighter-rouge">resetIteration()</code> methods)</li>
  <li><code class="highlighter-rouge">SectionFeature</code> implements <code class="highlighter-rouge">Iterable&lt;ProfileFeature&gt;</code> (replace <code class="highlighter-rouge">hasNext()</code>, <code class="highlighter-rouge">next()</code>, <code class="highlighter-rouge">finish()</code>, <code class="highlighter-rouge">resetIteration()</code> methods)</li>
  <li><code class="highlighter-rouge">SectionFeatureCollection</code> implements <code class="highlighter-rouge">Iterable&lt;SectionFeature&gt;</code> (replace <code class="highlighter-rouge">hasNext()</code>, <code class="highlighter-rouge">next()</code>, <code class="highlighter-rouge">finish()</code>, <code class="highlighter-rouge">resetIteration()</code> methods)</li>
</ul>

<h3 id="ucarnc2utildiskcache2">ucar.nc2.util.DiskCache2</h3>

<ul>
  <li>All instances of <code class="highlighter-rouge">DiskCache2</code> now have one cleanup thread</li>
  <li>The <code class="highlighter-rouge">DiskCache2.exit()</code> method is now static and need only be called once when the application is exiting.</li>
  <li><code class="highlighter-rouge">DiskCache2.setLogger()</code> is removed.</li>
  <li><code class="highlighter-rouge">DiskCache2.cleanCache(File dir, StringBuffer sbuff, boolean isRoot)</code> is now <code class="highlighter-rouge">DiskCache2.cleanCache(File dir, Formatter sbuff, boolean isRoot)</code></li>
  <li>deprecated methods are removed: <code class="highlighter-rouge">setCachePathPolicy(int cachePathPolicy, String cachePathPolicyParam)</code>, <code class="highlighter-rouge">setPolicy(int cachePathPolicy)</code></li>
  <li>logging of routine cache cleanup is now at <code class="highlighter-rouge">DEBUG</code> level</li>
</ul>

<h3 id="ucarma2range">ucar.ma2.Range</h3>

<ul>
  <li><code class="highlighter-rouge">Range.copy(String name)</code> replaced by <code class="highlighter-rouge">Range.setName(String name)</code></li>
  <li><code class="highlighter-rouge">Range.getIterator()</code> deprecated, use <code class="highlighter-rouge">Range.iterator()</code></li>
</ul>

<p>Currently a <code class="highlighter-rouge">Range</code> is specified by <em>start:end:stride</em>
In the future, may be extended with subclasses <code class="highlighter-rouge">RangeScatter</code> and <code class="highlighter-rouge">RangeComposite</code>
You should use the iterator now to ensure correct functionality.
To iterate over the values of the <code class="highlighter-rouge">Range</code>:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">range</span><span class="o">.</span><span class="na">first</span><span class="o">();</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">range</span><span class="o">.</span><span class="na">last</span><span class="o">();</span> <span class="n">i</span><span class="o">+=</span> <span class="n">range</span><span class="o">.</span><span class="na">stride</span><span class="o">())</span> <span class="o">{</span>    <span class="c1">// REPLACE THIS</span>
 <span class="c1">// ...</span>
<span class="o">}</span>

<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">:</span> <span class="n">range</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// USE THIS</span>
 <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="ucarnc2utilcache">ucar.nc2.util.cache</h3>

<ul>
  <li><code class="highlighter-rouge">FileCache</code> and <code class="highlighter-rouge">FileFactory</code> take a <code class="highlighter-rouge">DatasetUrl</code> instead of a String <code class="highlighter-rouge">location</code></li>
</ul>

<h3 id="ucarnc2dataset">ucar.nc2.dataset</h3>

<p>In order to disambiguate remote protocols, all using <em>http:</em>, the utility method <code class="highlighter-rouge">DatasetUrl.findDatasetUrl(location)</code> is used to determine the protocol and capture the result in a <code class="highlighter-rouge">DatasetUrl</code> object.
Because this can be expensive, the <code class="highlighter-rouge">DatasetUrl</code> should be calculated once and kept for the duration of the dataset access.
When the protocol is already known, the <code class="highlighter-rouge">DatasetUrl(ServiceType protocol, String location)</code> constructor may be used.
The API is changed to allow/require the application to compute these <code class="highlighter-rouge">DatasetUrls</code>.</p>

<ul>
  <li><code class="highlighter-rouge">NetcdfDataset.acquireDataset()</code> takes a <code class="highlighter-rouge">DatasetUrl</code> instead of a String location.</li>
  <li>
    <p>the general method of <code class="highlighter-rouge">NetcdfDataset.openDataset()</code> takes a DatasetUrl instead of a String location.
Variants use a String location, and call <code class="highlighter-rouge">DatasetUrl.findDatasetUrl(location)</code>.</p>
  </li>
  <li><code class="highlighter-rouge">CoordinateAxis2D.getMidpoints()</code> was deprecated and now removed, use <code class="highlighter-rouge">getCoordValuesArray()</code></li>
</ul>

<h3 id="ucarnc2ftpointfeature">ucar.nc2.ft.PointFeature</h3>

<ul>
  <li>Added method <code class="highlighter-rouge">getTimeUnit()</code>. An implementation exists in <code class="highlighter-rouge">ucar.nc2.ft.point.PointFeatureImpl</code>, so if your
<code class="highlighter-rouge">PointFeature</code> extends it, you shouldn’t need to do any work.</li>
  <li>Removed method <code class="highlighter-rouge">getObservationTimeAsDate()</code>. Instead, use <code class="highlighter-rouge">getObservationTimeAsCalendarDate().toDate()</code>.</li>
  <li>Removed method <code class="highlighter-rouge">getNominalTimeAsDate()</code>. Instead, use <code class="highlighter-rouge">getNominalTimeAsCalendarDate().toDate()</code>.</li>
  <li>Removed method <code class="highlighter-rouge">getData()</code>. Instead, use <code class="highlighter-rouge">getDataAll()</code>.</li>
</ul>

<h3 id="ucarma2mamath">ucar.ma2.MAMath</h3>

<ul>
  <li>Added method <code class="highlighter-rouge">equals(Array, Array)</code>. It is intended for use in <code class="highlighter-rouge">Object.equals()</code> implementations.
This means, among other things, that corresponding floating-point elements must be exactly equal, not merely within
some epsilon of each other.</li>
  <li>Added method <code class="highlighter-rouge">hashCode(Array array)</code>. It is intended for use in <code class="highlighter-rouge">Object.hashCode()</code> implementations and is
compatible with <code class="highlighter-rouge">equals(Array, Array)</code>.</li>
  <li>Renamed <code class="highlighter-rouge">isEqual(Array, Array)</code> to <code class="highlighter-rouge">nearlyEquals(Array, Array)</code>. This was done to avoid (some) confusion with the new
<code class="highlighter-rouge">equals(Array, Array)</code>, and to highlight that this method performs <em>approximate</em> comparison of floating-point numbers,
instead of the exact comparison done by <code class="highlighter-rouge">equals(Array, Array)</code>.</li>
</ul>

<h3 id="coordinate-systems">Coordinate Systems</h3>

<ul>
  <li><code class="highlighter-rouge">ucar.nc2.dataset.CoordTransBuilderIF</code> is split into <code class="highlighter-rouge">ucar.nc2.dataset.builder.HorizTransformBuilderIF</code> and <code class="highlighter-rouge">ucar.nc2.dataset.builder.VertTransformBuilderIF</code></li>
  <li><code class="highlighter-rouge">HorizTransformBuilderIF</code> now uses <code class="highlighter-rouge">AttributeContainer</code> instead of <code class="highlighter-rouge">NetcdfDataset</code>, <code class="highlighter-rouge">Variable</code></li>
  <li><code class="highlighter-rouge">CoordinateTransform.makeCoordinateTransform(NetcdfDataset ds, Variable ctv)</code> is now <code class="highlighter-rouge">ProjectionCT makeCoordinateTransform(AttributeContainer ctv)</code></li>
  <li>Previously, the optional <em>false_easting</em> and <em>false_northing</em> should match the units of the <em>x</em> and <em>y</em> projection coordinates in <code class="highlighter-rouge">ucar.nc2.dataset.CoordinateSystem</code></li>
  <li><code class="highlighter-rouge">List&lt;Dimension&gt; getDomain()</code> → <code class="highlighter-rouge">Collection&lt;Dimension&gt; getDomain()</code></li>
  <li>boolean <code class="highlighter-rouge">isSubset(List&lt;Dimension&gt; subset, List&lt;Dimension&gt; set)</code> → <code class="highlighter-rouge">isSubset(Collection&lt;Dimension&gt; subset, Collection&lt;Dimension&gt; set)</code></li>
</ul>

<h3 id="feature-datasets">Feature Datasets</h3>

<ul>
  <li><code class="highlighter-rouge">ucar.nc2.dt.TypedDatasetFactory</code> has been removed. Use <code class="highlighter-rouge">ucar.nc2.ft.FeatureDatasetFactoryManager</code></li>
  <li><code class="highlighter-rouge">ucar.nc2.dt.grid</code> is deprecated (but not removed) and is replaced by <code class="highlighter-rouge">ucar.nc2.ft2.coverage</code></li>
  <li><code class="highlighter-rouge">ucar.nc2.dt.point</code> and <code class="highlighter-rouge">ucar.nc2.dt.trajectory</code> have been removed, replaced by <code class="highlighter-rouge">ucar.nc2.ft.\*</code></li>
  <li>In <code class="highlighter-rouge">FeatureDataset</code>, deprecated methods <code class="highlighter-rouge">getDateRange()</code>, <code class="highlighter-rouge">getStartDate()</code>, <code class="highlighter-rouge">getStartDate()</code> have been removed</li>
  <li>In <code class="highlighter-rouge">FeatureDataset</code>, mutating method removed: <code class="highlighter-rouge">calcBounds()</code></li>
</ul>

<h3 id="point-feature-datasets-ucarnc2ft-and-ucarnc2ftpoint">Point Feature Datasets (<code class="highlighter-rouge">ucar.nc2.ft</code> and <code class="highlighter-rouge">ucar.nc2.ft.point</code>)</h3>

<ul>
  <li><code class="highlighter-rouge">FeatureCollection</code> has been renamed to <code class="highlighter-rouge">ucar.nc2.ft.DsgFeatureCollection</code> for clarity.</li>
  <li><code class="highlighter-rouge">SectionFeature</code> and <code class="highlighter-rouge">SectionFeatureCollection</code> have been renamed to <code class="highlighter-rouge">TrajectoryProfileFeature</code>, <code class="highlighter-rouge">TrajectoryProfileFeatureCollection</code> for clarity.</li>
  <li><code class="highlighter-rouge">FeatureType.SECTION</code> renamed to <code class="highlighter-rouge">FeatureType.TRAJECTORY_PROFILE</code> for clarity.</li>
  <li><code class="highlighter-rouge">NestedPointFeatureCollection</code> has been removed, use <code class="highlighter-rouge">PointFeatureCC</code> and <code class="highlighter-rouge">PointFeatureCCC</code> instead when working with <code class="highlighter-rouge">DsgFeatureCollection</code> in a general way.</li>
  <li>In all the Point Feature classes, <code class="highlighter-rouge">DateUnit</code>, <code class="highlighter-rouge">Date</code>, and <code class="highlighter-rouge">DateRange</code> have been replaced by <code class="highlighter-rouge">CalendarDateUnit</code>, <code class="highlighter-rouge">CalendarDate</code>, and <code class="highlighter-rouge">CalendarDateRange</code>:</li>
  <li>In <code class="highlighter-rouge">PointFeature</code> and subclasses, deprecated methods <code class="highlighter-rouge">getObservationTimeAsDate()</code>, <code class="highlighter-rouge">getNominalTimeAsDate()</code> have been removed</li>
  <li>In <code class="highlighter-rouge">ProfileFeature</code>, <code class="highlighter-rouge">getTime()</code> returns <code class="highlighter-rouge">CalendarDate</code> instead of <code class="highlighter-rouge">Date</code></li>
  <li>In <code class="highlighter-rouge">PointFeature</code> implementations and subclasses, all constructors use <code class="highlighter-rouge">CalendarDateUnit</code> instead of <code class="highlighter-rouge">DateUnit</code>, and all <code class="highlighter-rouge">subset()</code> and <code class="highlighter-rouge">flatten()</code> methods use <code class="highlighter-rouge">CalendarDateRange</code>, not <code class="highlighter-rouge">DateRange</code></li>
  <li>In <code class="highlighter-rouge">CFPointWriter</code> subclasses, all constructors use <code class="highlighter-rouge">CalendarDateUnit</code> instead of <code class="highlighter-rouge">DateUnit</code></li>
  <li>In <code class="highlighter-rouge">PointFeature</code>, deprecated method <code class="highlighter-rouge">getData()</code> is removed; usually replace it with <code class="highlighter-rouge">getDataAll()</code></li>
  <li>In <code class="highlighter-rouge">PointFeatureCollection</code>, mutating methods are removed: <code class="highlighter-rouge">setCalendarDateRange()</code>, <code class="highlighter-rouge">setBoundingBox()</code>, <code class="highlighter-rouge">setSize()</code>, <code class="highlighter-rouge">calcBounds()</code></li>
  <li>The time and altitude units for the collection can be found in the <code class="highlighter-rouge">DsgFeatureCollection</code>, and you can get the collection object from <code class="highlighter-rouge">PointFeature.getFeatureCollection()</code></li>
  <li>In <code class="highlighter-rouge">PointFeatureIterator</code> and subclasses, methods <code class="highlighter-rouge">setCalculateBounds()</code>, <code class="highlighter-rouge">getDateRange()</code>, <code class="highlighter-rouge">getCalendarDateRange()</code>, <code class="highlighter-rouge">getBoundingBox()</code>, <code class="highlighter-rouge">getSize()</code> have been removed. That information is obtained from the <code class="highlighter-rouge">DsgFeatureCollection</code>.</li>
  <li>In <code class="highlighter-rouge">PointFeatureIterator</code> and subclasses, <code class="highlighter-rouge">setBufferSize()</code> bas been removed.</li>
  <li>In <code class="highlighter-rouge">PointFeatureCollection</code> and subclasses, <code class="highlighter-rouge">getPointFeatureIterator()</code> no longer accepts a <code class="highlighter-rouge">bufferSize</code> argument.</li>
</ul>

<h3 id="coverage-feature-datasets-ucarnc2ft2coverage">Coverage Feature Datasets (<code class="highlighter-rouge">ucar.nc2.ft2.coverage</code>)</h3>

<ul>
  <li>Completely new package <code class="highlighter-rouge">ucar.nc2.ft2.coverage</code> that replaces <code class="highlighter-rouge">ucar.nc2.dt.grid</code>
The class <code class="highlighter-rouge">FeatureDatasetCoverage</code> replaces <code class="highlighter-rouge">GridDataset</code>.</li>
  <li>Uses of classes in <code class="highlighter-rouge">car.nc2.dt.grid</code> are deprecated, though the code is still in the core jar file for now.</li>
  <li>For new API see <a href="coverage_datasets.html">Coverage Datasets</a></li>
  <li><code class="highlighter-rouge">FeatureType.COVERAGE</code> is the general term for <code class="highlighter-rouge">GRID</code>, <code class="highlighter-rouge">FMRC</code>, <code class="highlighter-rouge">SWATH</code>, <code class="highlighter-rouge">CURVILINEAR</code> types.
Previously, <code class="highlighter-rouge">GRID</code> was used as the general type, now it refers to a specific type of Coverage.
Affects <code class="highlighter-rouge">FeatureDatasetFactoryManager.open(FeatureType wantFeatureType, ...)</code></li>
</ul>

<h3 id="shared-dimensions">Shared Dimensions</h3>

<ul>
  <li><code class="highlighter-rouge">Group.addDimension</code> and <code class="highlighter-rouge">Group.addDimensionIfNotExists</code> methods now throw an <code class="highlighter-rouge">IllegalArgumentException</code> if the
dimension isn’t shared.</li>
  <li><code class="highlighter-rouge">NetcdfFileWriter.addDimension</code> methods no longer have an <code class="highlighter-rouge">isShared</code> parameter. Such dimensions should always be
shared and allowing them to be private is confusing and error-prone.</li>
</ul>

<h3 id="catalog-api">Catalog API</h3>

<ul>
  <li>All uses of classes in <code class="highlighter-rouge">thredds.catalog</code> are deprecated. If you still need these, you must add <code class="highlighter-rouge">legacy.jar</code> to your path.</li>
  <li>TDS and CDM now use <code class="highlighter-rouge">thredds.server.catalog</code> and <code class="highlighter-rouge">thredds.client.catalog</code>. The APIs are different, but with equivalent functionality to thredds.catalog.</li>
  <li><code class="highlighter-rouge">thredds.client.DatasetNode</code> now has <code class="highlighter-rouge">getDatasetsLogical()</code> and <code class="highlighter-rouge">getDatasetsLocal()</code> that does or does not dereference a <code class="highlighter-rouge">CatalogRef</code>, respectively.
You can also use <code class="highlighter-rouge">getDatasets()</code> which includes a dereferenced catalog if it has already been read.</li>
</ul>

<h2 id="tds-data-services">TDS Data Services</h2>

<h3 id="netcdf-subset-service-ncss">Netcdf Subset Service (NCSS)</h3>

<p>NCSS queries and responses have been improved and clarified.
Generally the previous queries are backwards compatible. See <a href="netcdf_subset_service_ref.html">NCSS Reference</a> for details.</p>

<p>New functionality:</p>
<ul>
  <li>2D time can now be handled for gridded datasets, with addition of <code class="highlighter-rouge">runtime</code> and <code class="highlighter-rouge">timeOffset</code> parameters.</li>
  <li>Handling of interval coordinates has been clarified.</li>
  <li>Use <code class="highlighter-rouge">ensCoord</code> to select an ensemble member.</li>
</ul>

<p>Minor syntax changes:</p>
<ul>
  <li>Use <code class="highlighter-rouge">time=all</code> instead of <code class="highlighter-rouge">temporal=all</code></li>
  <li>For station datasets, <code class="highlighter-rouge">subset=stns</code> or <code class="highlighter-rouge">subset=bb</code> is not needed.
Just define <code class="highlighter-rouge">stns</code> or a bounding box.</li>
</ul>

<h3 id="cdmrfeature-service">CdmrFeature Service</h3>

<p>A new TDS service has been added for remote access to CDM Feature Datasets.</p>

<ul>
  <li>Initial implementation for Coverage (Grid, FMRC, Swath) datasets, based on the new Coverage implementation in <code class="highlighter-rouge">ucar.nc2.ft2.coverage</code>.</li>
  <li>Target is a python client that has full access to all of the coordinate information and coordinate based subsetting capabilities of the Java client.</li>
  <li>Compatible / integrated with the Netcdf Subset Service (NCSS), using the same web API.</li>
</ul>

<h3 id="threddsconfigxml"><code class="highlighter-rouge">ThreddsConfig.xml</code></h3>

<p>You no longer turn catalog caching on or off, but you can control how many catalogs are cached (see
<a href="tds_config_ref.html">here</a> for the new syntax).</p>

<p>The following is no longer used:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;Catalog&gt;</span>
  <span class="nt">&lt;cache&gt;</span>false<span class="nt">&lt;/cache&gt;</span>
<span class="nt">&lt;/Catalog&gt;</span>
</code></pre>
</div>

<ul>
  <li>By default, most services are enabled, but may still be turned off in <code class="highlighter-rouge">threddsConfig.xml</code>.</li>
</ul>

<h2 id="catalogs">Catalogs</h2>

<h3 id="catalog-schema-changes">Catalog Schema changes</h3>

<p>Schema version is now <code class="highlighter-rouge">1.2</code>.</p>

<h3 id="client-catalogs">Client Catalogs</h3>

<ul>
  <li><code class="highlighter-rouge">&lt;service&gt;</code> elements may not be nested inside of <code class="highlighter-rouge">&lt;dataset&gt;</code> elements, they must be directly contained in the <code class="highlighter-rouge">&lt;catalog&gt;</code> element.</li>
</ul>

<h3 id="server-configuration-catalogs">Server Configuration Catalogs</h3>

<ul>
  <li>The <code class="highlighter-rouge">&lt;catalogScan&gt;</code> element is now available, which scans a directory for catalog files (any file ending in xml)</li>
  <li>The <code class="highlighter-rouge">&lt;datasetFmrc&gt;</code> element is no longer supported</li>
  <li><code class="highlighter-rouge">&lt;datasetRoot&gt;</code> elements may not be contained inside of <em>service</em> elements, they must be directly contained in the <code class="highlighter-rouge">&lt;catalog&gt;</code> element</li>
  <li><code class="highlighter-rouge">&lt;service&gt;</code> elements may not be nested inside of <code class="highlighter-rouge">&lt;dataset&gt;</code> elements, they must be directly contained in the <code class="highlighter-rouge">&lt;catalog&gt;</code> element.</li>
  <li><code class="highlighter-rouge">&lt;service&gt;</code> elements no longer need to be explicitly defined in each config catalog, but may reference user defined global services</li>
  <li>If the <code class="highlighter-rouge">datatype/featureType</code> is defined for a dataset, then the <code class="highlighter-rouge">&lt;service&gt;</code> element may be omitted, and the default set of services for that <code class="highlighter-rouge">datatype</code> will be used.</li>
  <li>The <code class="highlighter-rouge">expires</code> attribute is no longer used.</li>
</ul>

<h3 id="viewers">Viewers</h3>

<ul>
  <li><code class="highlighter-rouge">thredds.servlet.Viewer</code> has <code class="highlighter-rouge">InvDatasetImpl</code> changed to <code class="highlighter-rouge">Dataset</code></li>
  <li><code class="highlighter-rouge">thredds.servlet.ViewerLinkProvider</code> has <code class="highlighter-rouge">InvDatasetImpl</code> changed to <code class="highlighter-rouge">Dataset</code></li>
  <li><code class="highlighter-rouge">thredds.server.viewer.dataservice.ViewerService</code> has <code class="highlighter-rouge">InvDatasetImpl</code> changed to <code class="highlighter-rouge">Dataset</code></li>
</ul>

<h3 id="datasetscan">DatasetScan</h3>

<ul>
  <li><code class="highlighter-rouge">addID</code> is no longer needed, ids are always added</li>
  <li><code class="highlighter-rouge">addDatasetSize</code> is no longer needed, the dataset size is always added</li>
  <li>With <code class="highlighter-rouge">addLatest</code>, the <code class="highlighter-rouge">service</code> name is no longer used, it is always <code class="highlighter-rouge">Resolver</code>, and the correct service is automatically added.
Use <code class="highlighter-rouge">addLatest</code> attribute for simple case.</li>
  <li><code class="highlighter-rouge">fileSort</code>: by default, datasets at each collection level are listed in increasing order by filename.
To change to decreasing order, use the <a href="tds_dataset_scan_ref.html#filesSort,filesSort">fileSort</a> element.</li>
  <li><code class="highlighter-rouge">sort</code>: deprecated in favor of <code class="highlighter-rouge">filesSort</code></li>
  <li>User pluggable classes implementing <code class="highlighter-rouge">UserImplType</code> (<code class="highlighter-rouge">crawlableDatasetImpl</code>, <code class="highlighter-rouge">crawlableDatasetFilterImpl</code>, <code class="highlighter-rouge">crawlableDatasetLabelerImpl</code>,
<code class="highlighter-rouge">crawlableDatasetSorterImpl</code>) are no longer supported. (This was never officially released or documented).</li>
  <li><code class="highlighter-rouge">DatasetScan</code> details are <a href="server_side_catalog_specification.html">here</a></li>
</ul>

<p>=== Standard Services</p>

<ul>
  <li>The TDS provides standard service elements, which know which services are appropriate for each Feature Type.</li>
  <li>User defined services in the root catalog are global and can be referenced by name in any other config catalog.</li>
  <li>User defined services in non-root catalogs are local to that catalog and override (by name) any global services.</li>
  <li>All services are enabled unless explicitly disabled
** Except for remote catalog services</li>
  <li>Standard service details are «reference/Services#,here»</li>
</ul>

<h3 id="featurecollections">FeatureCollections</h3>

<ul>
  <li>The <a href="feature_collections_ref.html#update">update</a> element default is now <code class="highlighter-rouge">startup="never"</code>, meaning do not update collection on startup, and use existing indices when the collection is accessed.</li>
  <li>
    <p>The <a href="tds_dataset_scan_ref.html#filesSort,filesSort">fileSort</a> element is now inside the <code class="highlighter-rouge">featureCollection</code> itself, so it can be processed uniformly for all types of feature collections.
When a collection shows a list of files, the files will be sorted by increasing name.
To use a decreasing sort, use the element <code class="highlighter-rouge">&lt;filesSort increasing="false" /&gt;</code> inside the <code class="highlighter-rouge">featureCollection</code> element.
This supersedes the old way of placing that element in the <code class="highlighter-rouge">&lt;gribConfig&gt;</code> element, or the older verbose <code class="highlighter-rouge">lexigraphicByName</code> element:</p>

    <div class="language-xml highlighter-rouge"><pre class="highlight"><code>  <span class="nt">&lt;filesSort&gt;</span>
    <span class="nt">&lt;lexigraphicByName</span> <span class="na">increasing=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>  // deprecated
  <span class="nt">&lt;/filesSort&gt;</span>
</code></pre>
    </div>
  </li>
  <li>Feature Collection details are <a href="feature_collections_ref.html">here</a></li>
</ul>

<h3 id="recommendations-for-50-catalogs">Recommendations for 5.0 catalogs</h3>

<ul>
  <li>Put all <code class="highlighter-rouge">&lt;datasetRoot&gt;</code> elements in root catalog.</li>
  <li>Put all <code class="highlighter-rouge">&lt;catalogScan&gt;</code> elements in root catalog.</li>
  <li>Use <code class="highlighter-rouge">StandardServices</code> when possible.
Annotate your datasets with <code class="highlighter-rouge">featureType</code> / <code class="highlighter-rouge">dataType</code>.</li>
  <li>Put all user-defined <code class="highlighter-rouge">&lt;service&gt;</code> elements in root catalog.</li>
  <li>Only use user-defined <code class="highlighter-rouge">&lt;service&gt;</code> elements in non-root catalogs when they are experimental or truly a special case.</li>
</ul>

<h3 id="recommendations-for-esgf">Recommendations for ESGF</h3>

<p>You must determine the number of datasets that are contained in all of your catalogs.
To get a report, enable <a href="remote_management_ref.html">Remote Management</a>, and from https://server/thredds/admin/debug, select “Make Catalog Report”.
This may take 5-20 minutes, depending on the numbers of catalogs.</p>

<p>Add the [<ConfigCatalog>](tds_config_ref.html#configuration-catalog) element to `threddsConfig.xml`:</ConfigCatalog></p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;ConfigCatalog&gt;</span>
  <span class="nt">&lt;keepInMemory&gt;</span>100<span class="nt">&lt;/keepInMemory&gt;</span>
  <span class="nt">&lt;reread&gt;</span>check<span class="nt">&lt;/reread&gt;</span>
  <span class="nt">&lt;dir&gt;</span>/tomcat_home/content/thredds/cache/catalog/<span class="nt">&lt;/dir&gt;</span>
  <span class="nt">&lt;maxDatasets&gt;</span>1000000<span class="nt">&lt;/maxDatasets&gt;</span>
<span class="nt">&lt;/ConfigCatalog&gt;</span>
</code></pre>
</div>

<p>where:</p>

<ul>
  <li><code class="highlighter-rouge">keepInMemory</code>: using the default value of 100 is probably good enough.</li>
  <li><code class="highlighter-rouge">reread</code>: use value of <em>check</em> to only read changed catalogs when restarting TDS.</li>
  <li><code class="highlighter-rouge">dir</code> is where the catalog cache files are kept.
Use the default directory (or symlink to another place) unless you have a good reason to change.</li>
  <li><code class="highlighter-rouge">maxDatasets</code>: this is the number you found in step 1.
Typical values for ESGF are 1 - 7 million.
This is a maximum, so its ok to make it bigger than you need.</li>
</ul>

<p>Here are some additional, optional changes you can make to increase maintainability:</p>

<ol>
  <li>Place all <code class="highlighter-rouge">datasetRoot</code> elements in the top catalog</li>
  <li>Place all <code class="highlighter-rouge">service</code> elements in the root catalog (<em>catalog.xml</em>).
These can be referenced from any catalog.</li>
  <li>Remove <code class="highlighter-rouge">&lt;service&gt;</code> elements from non-root catalogs.</li>
  <li>Add a <a href="server_side_catalog_specification.html#catalogScan">catalogScan</a> element to the root catalog, replacing the list of catalogRefs listing all the other catalogs.
    <ul>
      <li>This assumes that other catalogs live in a subdirectory under the root, for example <code class="highlighter-rouge">${tds.content.root.path}/thredds/esgcet/**</code>.</li>
    </ul>
  </li>
</ol>

<p>For example:</p>

<div class="language-xml highlighter-rouge"><pre class="highlight"><code>  <span class="cp">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span>
  <span class="nt">&lt;catalog</span> <span class="na">name=</span><span class="s">"ESGF Master Catalog"</span> <span class="na">version=</span><span class="s">"1.2"</span>
        <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xlink=</span><span class="s">"http://www.w3.org/1999/xlink"</span>
        <span class="na">xmlns=</span><span class="s">"http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0"</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.unidata.ucar.edu/namespaces/thredds/InvCatalog/v1.0 http://www.unidata.ucar.edu/schemas/thredds/InvCatalog.1.2.xsd"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;datasetRoot</span> <span class="na">location=</span><span class="s">"/esg/data"</span> <span class="na">path=</span><span class="s">"esg_testroot"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;datasetRoot</span> <span class="na">location=</span><span class="s">"/esg/arc/data/"</span> <span class="na">path=</span><span class="s">"esg_obs4MIPs"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;datasetRoot</span> <span class="na">location=</span><span class="s">"/esg/cordex/data/"</span> <span class="na">path=</span><span class="s">"esg_cordex"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;datasetRoot</span> <span class="na">location=</span><span class="s">"/esg/specs/data/"</span> <span class="na">path=</span><span class="s">"esg_specs"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;service</span> <span class="na">base=</span><span class="s">"/thredds/dodsC/"</span> <span class="na">desc=</span><span class="s">"OpenDAP"</span> <span class="na">name=</span><span class="s">"gridded"</span> <span class="na">serviceType=</span><span class="s">"OpenDAP"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"requires_authorization"</span> <span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"application"</span> <span class="na">value=</span><span class="s">"Web Browser"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/service&gt;</span>

    <span class="nt">&lt;service</span> <span class="na">base=</span><span class="s">""</span> <span class="na">name=</span><span class="s">"fileservice"</span> <span class="na">serviceType=</span><span class="s">"Compound"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;service</span> <span class="na">base=</span><span class="s">"/thredds/fileServer/"</span> <span class="na">desc=</span><span class="s">"HTTPServer"</span> <span class="na">name=</span><span class="s">"HTTPServer"</span> <span class="na">serviceType=</span><span class="s">"HTTPServer"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"requires_authorization"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"application"</span> <span class="na">value=</span><span class="s">"Web Browser"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"application"</span> <span class="na">value=</span><span class="s">"Web Script"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/service&gt;</span>

      <span class="nt">&lt;service</span> <span class="na">base=</span><span class="s">"gsiftp://cmip-bdm1.badc.rl.ac.uk/"</span> <span class="na">desc=</span><span class="s">"GridFTP"</span> <span class="na">name=</span><span class="s">"GridFTPServer"</span> <span class="na">serviceType=</span><span class="s">"GridFTP"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"requires_authorization"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"application"</span> <span class="na">value=</span><span class="s">"DataMover-Lite"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/service&gt;</span>

      <span class="nt">&lt;service</span> <span class="na">base=</span><span class="s">"/thredds/dodsC/"</span> <span class="na">desc=</span><span class="s">"OpenDAP"</span> <span class="na">name=</span><span class="s">"OpenDAPFiles"</span> <span class="na">serviceType=</span><span class="s">"OpenDAP"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"requires_authorization"</span> <span class="na">value=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"application"</span> <span class="na">value=</span><span class="s">"Web Browser"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/service&gt;</span>
    <span class="nt">&lt;/service&gt;</span>

    <span class="nt">&lt;catalogScan</span> <span class="na">name=</span><span class="s">"ESGF catalogs"</span> <span class="na">path=</span><span class="s">"esgcet"</span> <span class="na">location=</span><span class="s">"esgcet"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;/catalog&gt;</span>
</code></pre>
</div>


    <div class="tags">
        
    </div>

    

</div>

        </div>
      </div>
      <footer>
  <div class="row is-flex">
    <div class="col-sm-3">
      <div class="triptych-left">
        <div class="footer-logos">
          <a class="noicon" href="https://unidata.ucar.edu/software/tds/"> <img alt="TDS" src="images/thredds_tds-32x32.png"/></a>
        </div>
        <p class="triptych-header">THREDDS</p>
        <ul>
          <li>
            
            <span>Page last updated:<br /></span> April 2, 2018
            
          </li>
          <li>
            Documentation site last generated:<br /> April 19, 2018
          </li>
        </ul>
      </div>
    </div>

    <div class="col-sm-6">
      <div class="triptych-center">
        <div class="footer-logos">
          <a class="noicon" href="https://www.nsf.gov/"> <img alt="NSF" src="images/nsf_logo_transparent.png"/></a>
        </div>
        <div class="footer-logos" style="padding-right: 1em;">
          <a class="noicon" href="https://www.ucp.ucar.edu"> <img alt="UCP" src="images/ucp-logo2_transparent.png"/></a>
        </div>
        <p class="triptych-header">Unidata</p>
          <p class="triptych-center">
            Unidata is a member of the
            <a href="https://www.ucp.ucar.edu/">UCAR Community Programs</a>, managed by the
            <a href="https://www.ucar.edu">University Corporation for Atmospheric Research</a>, and funded by the
            <a href="https://www.nsf.gov">National Science Foundation</a>.
          </p>
          <p class="triptych-center">
            Read Unidata's
            <a href="https://www.unidata.ucar.edu/legal/participation.html">Participation Policy</a>.
          </p>
            <table class="triptych-center">
              <tr>
                <td style="width:33%;text-align:left;">&copy;2018 UCAR</td>
                <td style="width:33%;text-align:center;">
                  <a href="https://www2.ucar.edu/privacy-policy">Privacy Policy</a>
                </td>
                <td style="width:33%;text-align:right;">
                  <a href="https://www2.ucar.edu/terms-of-use">Terms of Use</a>
                </td>
              </tr>
            </table>
      </div>
    </div>

    <div class="col-sm-3">
      <div class="triptych-right">
        <div class="footer-logos">
          <a class="noicon" href="https://unidata.ucar.edu/"> <img alt="TDS" src="images/unilogo-32x32.png"/></a>
        </div>
        <p class="triptych-header">Contact Unidata</p>
        <ul>
          <li>
            For support:
              <a href="mailto:support@unidata.ucar.edu">support@unidata.ucar.edu</a>
          </li>
          <li>
            By
              <a href="https://www.unidata.ucar.edu/about/index.html#visit">postal mail</a>
            or
              <a href="https://www.unidata.ucar.edu/about/index.html#visit">in person</a>
          </li>
          <li>
            About this website:
              <a href="mailto:plaza@unidata.ucar.edu">plaza@unidata.ucar.edu</a>
          </li>
          <li>
            By telephone:
            303.497.8643
          </li>
        </ul>

      </div>
    </div>

  </div>
</footer>

    </div>
    <!-- /.row -->
  </div>
  <!-- /.container -->
</body>
 <!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-92978945-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>
 

</html>
